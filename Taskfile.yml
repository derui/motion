# https://taskfile.dev

version: '3'

vars:
  EMACS_BATCH: emacs -Q --batch -L .

tasks:
   
  build:
    sources:
      - "motion.el"
      - "motion-tests.el"
    generates:
      - "motion.elc"
      - "motion-tests.el"
    cmds:
      - for: sources
        cmd: '{{ .EMACS_BATCH }} -f batch-byte-compile {{ .ITEM }}'

  test:
    deps: [build]
    cmds:
      - '{{ .EMACS_BATCH }} -l motion-tests.el -l ert --eval "(ert-run-tests-batch-and-exit)"'
      - '{{ .EMACS_BATCH }} -l motion-tests.elc -l ert --eval "(ert-run-tests-batch-and-exit)"'
  clean:
    cmds:
      - find . -type f -name "*.elc" | xargs rm
